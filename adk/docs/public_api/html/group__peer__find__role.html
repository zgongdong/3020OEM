<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Public API: Peer Find Role Service (LE)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(initResizable);
/* @license-end */</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Public API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__peer__find__role.html','');});
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Peer Find Role Service (LE)<div class="ingroups"><a class="el" href="group__services.html">Services</a> &raquo; <a class="el" href="group__peer__service.html">Peer Service</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>Peer service for finding peer using LE and selecting the role.  
<a href="#details">More...</a></p>
<p>Peer service for finding peer using LE and selecting the role. </p>
<p>The peer find role service is responsible for finding a peer device, and determining the roles each device should take based on the state of the devices.</p>
<p><br  />
</p>
<p>The service is started by a call to PeerFindRole_FindRole(). The service then continues until a peer device is detected and a role selected. A timeout can be supplied in the initial call to PeerFindRole_FindRole(). When this timeout expires a #PEER_FIND_ROLE_ACTING_PRIMARY message is sent to the registered tasks, but the service continues looking for a role.</p>
<p>The service operates by scanning for devices and also advertising its presence, normally simultaneously. Exceptions to this are </p><ul>
<li>After a connection failure the start of advertising is delayed. If the failure was caused by the two devices connecting to each other at the same time, this should ensure that only one is advertising initially. </li>
<li>If a device is busy with media, either music or a telephone call then the device will not scan. This means that if both devices are busy, perhaps connected to different devices, they will not be able to connect to each other until one stops.</li>
</ul>
<p>Once devices are discovered and a connection made, the role is determined by comparison of a figure of merit provided by the GATT role selection service. This allows a decision to be made and one device is told to assume the primary role with the message #PEER_FIND_ROLE_PRIMARY, while the other will be told #PEER_FIND_ROLE_SECONDARY.</p>
<dl class="section note"><dt>Note</dt><dd>After sending a #PEER_FIND_ROLE_PRIMARY message, the find role procedure will continue, advertising only. This will be stopped by either a call to PeerFindRole_FindRoleCancel() or PeerFindRole_FindRole().</dd></dl>
<p>For more comprehensive details of the implementation look at the state machine documentation below (state transitions).</p>
<p>As part of the implementation internal messages are sometimes sent delayed, offering the chance for them to be cancelled, or using condition flags so that messages are sent when all activities blocking them have finished. See the media_busy element of <a class="el" href="structpeer_find_role_task_data.html">peerFindRoleTaskData</a> as an example.</p>
<h2>State transitions</h2>
<p>The LE peer find role service uses a state variable to record its current status see #PEER_FIND_ROLE_STATE for state names. The use of the state allows the processing of messages and function calls to check what action is required, or error to generate.</p>
<p>The state is set using the function peer_find_role_set_state(). This function can trigger actions based on the state that has been entered (or exited).</p>
<p>The basics of the state are documented in the diagram below.</p>
<div class="plantumlgraph">
<img src="inline_umlgraph_3.png" />
</div>
 </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.16 </li>
  </ul>
</div>
</body>
</html>
